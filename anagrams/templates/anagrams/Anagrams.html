{% extends "global/Page.html" %}
{% load staticfiles otree_tags %}
{% load otreechat %}


{% block title %}
    Anagrams Exercise
{% endblock %}

{% block content %}

    {% block myscripts %}
        <script type="text/javascript">
            // var from_django = "foobar";
            var varsFromDjango = {{ vars_for_js }};
        </script>
        <script type="text/javascript" src="{% static 'anagrams/rivets.bundled.min.js' %}"></script>

        <script type="text/javascript">
        // Create cookie
        function createCookie(name, value, days) {
            var expires;
            if (days) {
                var date = new Date();
                date.setTime(date.getTime()+(days*24*60*60*1000));
                expires = "; expires="+date.toGMTString();
            }
            else {
                expires = "";
            }
            document.cookie = name+"="+value+expires+"; path=/";
        }

        // Read cookie
        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0) === ' ') {
                    c = c.substring(1,c.length);
                }
                if (c.indexOf(nameEQ) === 0) {
                    return c.substring(nameEQ.length,c.length);
                }
            }
            return null;
        }

        // Erase cookie
        function eraseCookie(name) {
            createCookie(name,"",-1);
        }
        </script>
    {% endblock %}

    <div id="app-view" class="row" style="background: white;">
        <div class="modal fade" id="get-ready-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
  			<div class="modal-dialog" role="document">
    			<div class="modal-content">
      			<div class="modal-header">        				
            <h4>
              Get Ready to Play!
              
            </h4>
            </div>
            <div class="modal-body" style="max-height: 600px; overflow-y:auto;">
                  The game will begin in:
            	  <h1 class="text-center" id="countdown-number">5</h1>
      			</div>
    			</div>
  			</div>
	 </div>
               
        <div class="row" style="padding-left: 15px; padding-right: 30px; margin: 0;">
				{% comment %}
        		<h3><b>Welcome, {app.user.name}!</b></h3>        		
        		{% endcomment %}
        </div>

		  
		  <div class="row">
		  		<div class="col-xs-5 col-md-5" style="padding: 30px; padding-top: 5px;">
		  			<div class="row" style="height:275px;">
                	<div class="col-md-12">
                    <div id="your-letters" class="row">
                      <h4><span class="glyphicon glyphicon-user" aria-hidden="true"></span>&nbsp;<b>Your Letters</b></h4>
                			<div class="row letter-row" style="padding-left: 12px;">
                				<button type="button" class="btn btn-info letter" rv-each-letter="app.user.letters"
                        	style="margin-left: 5px; margin-bottom: 5px; display: inline-block; background-image: none;"><strong>{ letter }</strong>
                				</button>
                			</div>
                		</div>
                		<div id="team-letters" class="row" style="margin-top: 5px;">
                      <h4 style="margin: 0;">
                      	<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                      	<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                      	<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                      	&nbsp;<b>Team Provided Letters</b></h4>
                      	<button id="get-team-letters" type="button" class="btn btn-default" data-toggle="modal" data-target="#myModal"
                       	style="background-image: none; display: inline-block; height: 25px; padding: 3px;">
								<span class="glyphicon glyphicon-download" aria-hidden="true"></span>                       	
                       	Request More Letters
                			</button>
      						<p id="transaction_message" style="font-weight: bold; color:red;">{app.transactionError}</p>
                			<div  class="row letter-row" style="padding-left: 12px; margin-top: 8px;">
                				<button type="button" class="btn btn-success letter" style="background-image: none; display: inline-block; margin-bottom: 5px; margin-left: 5px;"
                        			rv-each-transaction="app.user.transactions" rv-show="transaction.approved"><strong>{transaction}</strong>
                				</button>
                    			<button rv-each-transaction="app.user.transactions" type="button" class="btn btn-warning disabled" style="display: inline-block; background-image: none; margin-bottom: 5px; margin-left: 5px;"
                                		rv-hide="transaction.approved"><strong>{transaction}</strong>
                        	</button>
								</div>
							</div>
                   </div>
            	</div>   
		  		</div>

				<div class="col-xs-7 col-md-7">
        			<div id="word-panel" class="panel panel-default">
        				<div class="panel-heading">

							<h4 style="padding: 0; margin: 2px; font-weight: bold;">
        					<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                     <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                     <span class="glyphicon glyphicon-user" aria-hidden="true"></span>							
							&nbsp;&nbsp;Your Team's Words</h4>
						 	<p style="font-size: 10pt;"><em>Duplicate words allowed.</em> </p>
							<div class="row" style="height: 25px; overflow: hidden; border-bottom: black groove 1px">
								<span style="font-weight: bold;padding-left: 5px;">Trending Now: </span>
								<button rv-each-word="app.trendingWords" type="button" class="btn disabled" style="padding: 2px; background-image: none; background-color: #222222; text-align: center; font-weight: bold; font-size: 8pt; border-color: black; color: white; margin: 2px; display: inline-block;">
                        	<span style="vertical-align: bottom;">{ word.word }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="badge badge-primary" style="width: 3em; color: black; background-color: white; font-size: 6pt; border-style: solid; border-color: black; border-width: 1pt;">{ word.freq }</span>
                    		</button>
							</div>
						</div>
						<div id="word-tiles" class="panel-body" style="padding-top: 0px; height:200px; overflow-y: auto;">

            			<div  class="row">                	
                			<button rv-id="word.id" rv-each-word="app.successWords" type="button" rv-addclass="word.class" class="btn btn-default disabled" style="background-image: none; background-color: #EEEEEE; text-align: center; font-weight: bold; font-size: 10pt; border-color: black; color: black; margin: 2px; display: inline-block;">
                        	<span style="vertical-align: bottom;">{ word.word }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="badge badge-primary" style="width: 3em; color: black; background-color: white; font-size: 8pt; border-style: solid; border-color: black; border-width: 1pt;">{ word.freq }</span>
                    		</button>
            			</div>
        				</div>
        				<div id="score-div" class="panel-footer">
        					<p style="width:100%; text-align: right; margin:0; font-size: 10pt;">
								<strong>Word Count: <span id="word_count" style="display: inline-block; width:3em; text-align: right;">{app.wordCount}</span> words</strong>
							</p>
							<p style="width:100%; text-align: right; margin:0; font-size: 10pt;">
								Record to Beat: <span id="word_count_beat" style="display: inline-block; width:3em; text-align: right;">{{session.config.bestScore}}</span> words
							</p>        				
        				</div>
		  			</div>                
        		</div>		  
		  </div>       
        
       <div class="row" style="padding-top: 0;">
       
         <div class="col-xs-12 col-md-5" style="display: inline-block;">
        		<div class="row" style="padding-left: 15px; bottom: 0px;">
        			<div id="word-input-group" class="col-xs-12 col-md-12" style="padding: 0;">
         			<p style="margin:0; font-size: 8pt;">
                     <span class="label label-warning">Orange</span> letters need teammate approval.
                  </p>
						<p style="margin:1; font-size:10pt;">Type any of the letters appearing in <span class="label label-info">blue</span> or <span class="label label-success">green</span> to form a word:</p>
						<div class="row input-group otree-chat" id='anagrams-words-{{ word_channel }}' style="border: 0px; padding-top: 0px; margin:0; bottom: 0px;">
							<div>
								<input style="padding-left: 30px", type="text" id="word-input" class="form-control" placeholder="Enter your word here...">
								<span style="cursor: pointer; color: gray; display: block; position: absolute; top: 12px;left: 3%;" id="searchclear" class="glyphicon glyphicon-remove-circle"></span>
							</div>      					
      					      					
      					<span class="input-group-btn">
        						<button class="btn btn-default" type="button"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>&nbsp;&nbsp;Submit Word!</button>
      					</span>

    					</div>
    					<p style="margin-top: 7px; color:red; padding-left: 10px; font-weight: bold;">{app.wordError}</p>
    					<!-- <p style="font-size: 10pt;">or, if you are out of words to make:</p> -->
    				</div>
    					<div class='messages' style="height: 0px;"></div>
          	</div>
         </div>
		 	<div id="copy-letters-div" class="col-xs-12 col-md-7" style="display: inline-block; padding-top: 5px; padding-right: 15px;">
		  		<div  class="panel panel-default">
		  			<div class="panel-heading">
						<h4 style="padding: 0; font-weight: bold; margin: 2px;">
						<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                  <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                  <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                  &nbsp;&nbsp;Copy Your Letters to the Team:</h4>
						<p style="font-size: 9pt; margin:0;"><em>Help your team!</em> Letter requests from your team will appear below. <strong>Click on a request to copy and send them a letter.</strong></p>		  			
		  			</div>
		  			<div class="panel-body" style="padding:0; height:100px; overflow-y: auto;">
                        <button type="button" class="btn btn-info" style="margin: 2px;"
                                rv-on-click="transaction.approve" 
                                rv-hide="transaction.approved" 
                                rv-each-transaction="app.requests">
                                <span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span>
                             Copy "{transaction}" for {transaction.borrower}
                        </button>
		  			</div>
        		</div>
        </div>
		</div>
		
		 <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  			<div class="modal-dialog" role="document">
    			<div class="modal-content">
      			<div class="modal-header">
        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        				
        				<h4 style="font-weight: bold; padding: 0;">
							<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                     <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                     <span class="glyphicon glyphicon-user" aria-hidden="true"></span>        				
        				Need more letters?</h4> 
            <div class="modal-body" style="max-height: 600px; overflow-y:auto;">
						<p><em>No problem!</em> We've made it so you can see what a few of your team members have. Choose a letter, and just click on what you need:</p>
      			</div>
                		<ul class="list-group">
                    	<li class="list-group-item" rv-each-friend="app.friends">
                        <p style="margin-bottom: 5px;"><b>{ friend.name }</b></p>
                        <button type="button" class="btn btn-default" data-dismiss="modal" rv-each-letter="friend.letters"
                                rv-on-click="letter.requestLetter" rv-class-disabled="letter.requested" style="margin-left: 5px;">{ letter }
                        </button>

                    	</li>
                		</ul>
      			</div>
    			</div>
  			</div>
			</div>
			<div class="modal fade" id="Instructions" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  			<div class="modal-dialog" role="document">
    			<div class="modal-content">
      			<div class="modal-header">
        				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        				
        				<h4 style="font-weight: bold; padding: 0;">
							Instructions:</h4> 
      			</div>
      			<div class="modal-body" style="max-height: 600px; overflow-y:auto;">
                		{% include 'instructions_anagrams/instructions_anagram.html' %}	
      			</div>
    			</div>
  			</div>
			</div>    

<div class="row" style="text-align: center; padding-left: 15px; padding-right: 15px;">
	<button id="info-detail" type="button" class="btn btn-default" data-toggle="modal" data-target="#Instructions"
           style="background-image: none; display: inline-block; height: 25px; margin: auto; padding: 3px;">
		<span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span>                       	
       	View Detailed Instructions
   </button>  
   <p style="text-align: justify;"><strong>Team Anagrams »</strong> How many words can you create with your set of letters? Remember, if you run out of ideas, you can always look at
        		your teammates' letters to make requests! Duplicate words are ok. Submit anything you can, let us determine if it is a word!
        		<b><em>Can your team beat the previous record of {{session.config.bestScore}} words?</em></b></p>
</div>
  

	 {% if session.config.use_chat %}
    <div class="row" style="background: white; padding: 10px 10px 20px 10px; border-color: lightgray;
                border-radius: 12px; border-width: 3px; border-style: groove;">
        <div class="col-md-12">
            {% for chat in player.chats %}
                {% if forloop.counter0|divisibleby:2 %}
                    <div class="row" style="margin-top: 10px;">
                {% endif %}
            <div class="col-md-6">
                <b>{{ chat.label }}</b>
                {% chat nickname=player.chat_nickname channel=chat.channel %}
            </div>
            {% if not forloop.counter0|divisibleby:2 or forloop.last %}
                </div>
            {% endif %}
            {% endfor %}

        </div>
    </div>
   

    <br/><br/>
     {% endif %}

{% if session.is_demo %}
<div style="text-align: center">{% next_button %}</div>
{% endif %}

{% endblock %}

{% block global_scripts %}
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript">

    // hack it up
    $('#main_container > .row').css('margin-top', '60px');

    $(".modal-dialog").draggable({
        handle: ".modal-header"
    });

    var cookieName = "getreadymodal_" + varsFromDjango.participant_code;
    if (!!!readCookie(cookieName)) {
      createCookie(cookieName, "true", 1000);
      $('#get-ready-modal').modal();
    }


    var timeRemaining = 5;

    var countdown = function () {
      timeRemaining--;
      if (timeRemaining > 0) {
        $('#countdown-number').text(timeRemaining);
        setTimeout(countdown, 1000);
      }
      else {
        $('#get-ready-modal').modal('hide');
      }
    };
    setTimeout(countdown, 1000);


		$(".letter-row").on('click','.letter', function () {
			var letter= $.trim($(this).text());
			$("#word-input").val($.trim($("#word-input").val()) + letter);
		});
		
		$("#searchclear")
		.hover(function() {
			$(this).css('color', 'black');		
		},function () {
			$(this).css('color', 'gray');
		})
		.click(function () {
			$("#word-input").val("");
		});
		
		(function($) {
    		$.fn.goTo = function(complete_func) {
    			var offset = $(this).offset().top - $('#word-tiles').offset().top + $('#word-tiles').scrollTop();
        		$('#word-tiles').animate({
            scrollTop: offset + 'px'
        		}, 'fast', function (complete_func) {
        		complete_func;	
        		});
        		return this;
    		}
		})(jQuery);
		
    </script>
    <script type="text/javascript" src="{% static 'anagrams/game.js' %}"></script>
    <style>
        .otree-chat {
            border: 1px solid #ccc;
            padding: 5px;
            margin: 5px 0 0 0;
        }

        .otree-chat .messages {
            height: 70px;
            overflow-y: auto;
            background: #eee;
            margin: 2px 0 5px 0;
        }

        .otree-chat .nickname {
            display: inline-block;
            color: #C07A36;
            font-weight: bold;
        }

        .modal-header h4 {
          cursor: move;
        }
    </style>

{% endblock %}
